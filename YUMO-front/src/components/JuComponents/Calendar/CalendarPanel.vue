<template>
  <div class="calendar-panel">
    <div class="calendar-window">
      <img :src="app.webOption.homeWallPaper" alt="" />
    </div>
    <div class="current-date">{{ dateInfo?.lunarStr }}</div>
    <div class="calendar-birthday" v-if="dateInfo?.birthday">
      <span>🎂</span>
      <span class="name">{{ dateInfo?.birthday.name }}</span>
      <span class="date">{{
        ` ${dateInfo?.birthday.date} (${
          dateInfo?.birthday.isLunar ? "农 " + dateInfo?.birthday.lunar : "阳"
        })`
      }}</span>
    </div>
    <ju-title :h="'h4'">今日任务</ju-title>
    <div class="task-list" v-if="todoList.length">
      <div
        class="task-item line-bar"
        v-for="(item, index) in todoList"
        :key="index"
      >
        <span class="task_number">{{ index + 1 }}.</span>
        <div class="task_content">
          <ju-popover>
            <template v-slot:reference>
              {{ item.todoThing }}
            </template>
          </ju-popover>
        </div>
        <ju-icon
          :name="item.isEnd ? 'smile' : 'sad'"
          :size="22"
          :color="item.isEnd ? '#3fb20e' : '#E4786C'"
        ></ju-icon>
      </div>
    </div>
    <div v-else class="nothing">
      <div class="flex-c">
        休憩
        <svg
          t="1746718144126"
          class="ml-10"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="1598"
          width="20"
          height="20"
        >
          <path
            d="M220.3648 912.913554s156.768549-7.835063 260.953234-8.788845c115.758811-1.059109 300.163657 8.788846 300.163657 8.788845l191.318309 21.632732s-298.896823 17.712274-491.481966 17.577691C292.425143 951.99232 17.554286 934.546286 17.554286 934.546286l202.810514-21.632732z"
            fill="#000000"
            opacity=".5"
            p-id="1599"
          ></path>
          <path
            d="M127.657691 72.431909c4.765989-6.606263 13.320777-15.108389 25.78432-13.788892 10.491611 1.111771 27.390537 6.038674 46.650515 12.603977 19.766126 6.73792 43.476114 15.72864 68.312503 25.755063 44.696137 18.039954 93.561417 39.637577 130.323017 57.870629A533.735131 533.735131 0 0 1 494.445714 146.285714c35.064686 0 69.210697 3.3792 102.022583 9.777737 35.989211-17.855634 82.727497-38.654537 125.597989-56.118125 24.608183-10.026423 48.101669-19.017143 67.689325-25.757989 19.078583-6.565303 35.845851-11.498057 46.273098-12.61568 12.501577-1.337051 21.024183 7.267474 25.719954 13.838629 5.12 7.162149 9.371063 16.828709 13.039908 27.4432 7.422537 21.480594 13.80352 50.936686 19.213166 82.970331 10.8544 64.3072 18.230126 141.80352 21.714652 193.536 0.084846 1.29024 0.002926 2.548297-0.231132 3.759543C940.116846 431.539931 953.782857 485.02784 953.782857 541.257143c0 218.135406-205.651383 394.971429-459.337143 394.971428S35.108571 759.392549 35.108571 541.257143c0-56.618423 13.853257-110.454491 38.806675-159.135452a14.587611 14.587611 0 0 1-0.73728-5.696365c3.513783-51.735406 10.962651-129.237577 21.916525-193.550629 5.459383-32.036571 11.901806-61.498514 19.397486-82.98496 3.703954-10.620343 7.998903-20.29568 13.165714-27.457828z m754.761143 257.287314c-3.996526-44.061257-9.80992-94.851657-17.267565-139.027017-5.336503-31.612343-11.401509-59.143314-18.013623-78.280412-3.349943-9.689966-6.509714-16.237714-9.189669-19.98848a20.84864 20.84864 0 0 0-1.114697-1.439451c-7.285029 1.214171-20.155246 4.880091-37.557394 10.866103-18.908891 6.509714-41.869897 15.289783-66.17088 25.1904-30.485943 12.419657-62.83264 26.498194-91.659703 39.906743 100.343223 29.12256 185.162606 87.2448 240.973531 162.772114z m-308.068937-147.924114a14.628571 14.628571 0 0 0 20.450743 7.90528 845.4144 845.4144 0 0 1 5.833874-2.993006C789.202651 227.284114 924.525714 373.39136 924.525714 541.257143c0 197.988937-188.25216 365.714286-430.08 365.714286S64.365714 739.24608 64.365714 541.257143c0-169.6768 138.26048-317.126949 330.017646-355.825372l2.68288 1.369235a14.628571 14.628571 0 0 0 19.08736-5.257509A509.29664 509.29664 0 0 1 494.445714 175.542857c27.387611 0 54.08768 2.1504 79.904183 6.255177zM257.45408 124.132206c31.808366 12.84096 65.623771 27.451977 95.451429 41.264274-102.882743 28.625189-189.878857 87.61344-246.693303 164.676754 4.043337-44.801463 10.011794-97.016686 17.723977-142.280411 5.38624-31.612343 11.506834-59.134537 18.180388-78.262857 3.376274-9.68704 6.565303-16.228937 9.268663-19.976777 0.476891-0.661211 0.871863-1.149806 1.18784-1.509669 7.358171 1.193691 20.41856 4.877166 38.078172 10.898286 19.093211 6.509714 42.27072 15.289783 66.802834 25.1904zM153.4976 87.157029c0 0.008777-0.058514 0.058514-0.181394 0.128731 0.119954-0.1024 0.181394-0.134583 0.181394-0.128731z m682.370194 2.884754c0 0.008777 0.064366 0.064366 0.187246 0.137508-0.12288-0.108251-0.187246-0.146286-0.187246-0.137508z"
            fill="#614D4C"
            p-id="1600"
          ></path>
          <path
            d="M156.525714 87.771429c34.026057 3.677623 191.578697 64.06144 264.774217 102.4C190.21824 253.425371 163.84 339.382857 100.937143 394.971429c-3.452343-103.511771 21.556663-310.880549 55.588571-307.2zM833.828571 89.234286c-34.034834 3.66592-181.326994 64.242834-254.534217 102.4C772.388571 264.777143 820.662857 342.308571 886.491429 397.897143c3.449417-103.026103-18.625097-312.322926-52.662858-308.662857z"
            fill="#9D7A6F"
            p-id="1601"
          ></path>
          <path
            d="M924.525714 541.257143c0 203.594606-192.55296 368.64-430.08 368.64S64.365714 744.851749 64.365714 541.257143 256.918674 172.617143 494.445714 172.617143s430.08 165.045394 430.08 368.64z"
            fill="#F8E8D9"
            p-id="1602"
          ></path>
          <path
            d="M160.334994 134.582857c34.175269 20.140617 117.332846 72.197851 100.837669 82.306194-48.888686 29.965166-117.543497 86.884937-128.936229 101.235566-11.392731 14.350629 6.834469-174.477897 28.09856-183.54176z m671.147155 0c-34.175269 20.140617-117.332846 72.197851-100.837669 82.306194 48.888686 29.965166 117.543497 86.884937 128.936229 101.235566 11.392731 14.350629-6.834469-174.477897-28.09856-183.54176z"
            fill="#F8E8D9"
            opacity=".3"
            p-id="1603"
          ></path>
          <path
            d="M851.382857 541.257143c0-115.565714-191.634286-257.462857-351.085714-257.462857S140.434286 428.617143 140.434286 554.422857c0 100.937143 149.211429 219.428571 359.862857 219.428572s351.085714-121.335223 351.085714-232.594286z"
            fill="#9D7A6F"
            p-id="1604"
          ></path>
          <path
            d="M653.826926 552.723017c-34.701897 0-62.83264-17.241234-62.83264-51.621303 0-34.377143 14.628571-62.244571 62.83264-62.244571S719.725714 465.179794 719.725714 496.549303c0 34.377143-27.794286 56.173714-65.898788 56.173714z m-292.430995 0.005852c34.701897 0 62.83264-17.238309 62.83264-51.618378 0-34.377143-14.628571-62.244571-62.83264-62.244571S295.497143 465.188571 295.497143 496.55808c0 34.377143 27.794286 56.170789 65.898788 56.170789z"
            fill="#B9D6EC"
            p-id="1605"
          ></path>
          <path
            d="M545.025463 560.552229c1.468709-1.026926 2.083109-2.165029 2.083108-3.712732 0-1.793463-0.842606-4.224731-2.799908-7.010011-1.928046-2.738469-4.786469-5.596891-8.405577-8.194926-7.244069-5.196069-17.261714-9.15456-28.291657-9.15456-11.029943 0-21.047589 3.958491-28.291658 9.15456-3.619109 2.598034-6.477531 5.456457-8.405577 8.194926-1.957303 2.78528-2.799909 5.216549-2.799908 7.010011 0 1.547703 0.6144 2.685806 2.083108 3.712732 1.629623 1.138103 4.23936 2.059703 7.931612 2.720914 7.366949 1.319497 17.680091 1.389714 29.482423 1.389714s22.115474-0.070217 29.482422-1.389714c3.692251-0.661211 6.301989-1.582811 7.931612-2.720914zM507.611429 567.588571c23.42912 0 42.422857-0.24576 42.422857-10.749074S531.040549 529.554286 507.611429 529.554286s-42.422857 16.781897-42.422858 27.285211c0 10.503314 18.993737 10.749074 42.422858 10.749074z"
            fill="#634011"
            p-id="1606"
          ></path>
          <path
            d="M518.012343 567.535909c18.402743-0.263314 32.021943-1.80224 32.021943-10.696412 0-10.503314-18.993737-27.285211-42.422857-27.285211s-42.422857 16.781897-42.422858 27.285211c0 8.894171 13.622126 10.433097 32.027795 10.696412 0.602697 8.06912-0.295497 18.630949-7.235292 25.781394-7.124114 7.334766-23.903086 14.236526-63.730834 4.809874a8.777143 8.777143 0 1 0-4.043337 17.083246c41.711909 9.87136 66.636069 4.476343 80.366446-9.663634a40.42752 40.42752 0 0 0 5.14048-6.518492 40.617691 40.617691 0 0 0 5.395017 6.626743c14.093166 14.014171 39.666834 19.417966 82.765531 9.570011a8.777143 8.777143 0 1 0-3.91168-17.112502c-41.34912 9.450057-58.970697 2.557074-66.475154-4.906423-7.18848-7.14752-8.101303-17.65376-7.4752-25.670217z"
            fill="#634011"
            p-id="1607"
          ></path>
          <path
            d="M359.862857 887.00928c0 11.0592-2.884754 18.733349-7.176777 24.640366-4.514377 6.217143-11.881326 12.220709-23.309166 17.451885C305.78688 939.906194 270.286263 945.005714 226.742857 945.005714s-79.044023-5.09952-102.634057-15.904183c-11.42784-5.231177-18.794789-11.234743-23.309166-17.451885-4.292023-5.907017-7.176777-13.581166-7.176777-24.640366 0-22.870309 12.744411-49.122743 37.443292-70.489234C155.431497 795.4432 189.31712 781.165714 226.742857 781.165714c37.425737 0 71.31136 14.277486 95.676709 35.354332C347.118446 837.886537 359.862857 864.138971 359.862857 887.00928z m29.257143 0C389.12 953.853074 316.421851 974.262857 226.742857 974.262857S64.365714 953.853074 64.365714 887.00928C64.365714 820.168411 137.063863 751.908571 226.742857 751.908571s162.377143 68.25984 162.377143 135.100709z m500.297143 0c0 11.0592-2.884754 18.733349-7.176777 24.640366-4.514377 6.217143-11.881326 12.220709-23.309166 17.451885-23.590034 10.804663-59.090651 15.904183-102.634057 15.904183s-79.044023-5.09952-102.634057-15.904183c-11.42784-5.231177-18.794789-11.234743-23.309166-17.451885-4.292023-5.907017-7.176777-13.581166-7.176777-24.640366 0-22.870309 12.744411-49.122743 37.443291-70.489234C684.985783 795.4432 718.871406 781.165714 756.297143 781.165714c37.425737 0 71.31136 14.277486 95.676708 35.354332C876.672731 837.886537 889.417143 864.138971 889.417143 887.00928z m29.257143 0C918.674286 953.853074 845.976137 974.262857 756.297143 974.262857s-162.377143-20.409783-162.377143-87.253577C593.92 820.168411 666.618149 751.908571 756.297143 751.908571s162.377143 68.25984 162.377143 135.100709z"
            fill="#614D4C"
            p-id="1608"
          ></path>
          <path
            d="M226.742857 953.782857c73.520274 0 133.12-16.65024 133.12-71.179703S300.263131 772.388571 226.742857 772.388571 93.622857 828.073691 93.622857 882.603154C93.622857 937.132617 153.222583 953.782857 226.742857 953.782857z m529.554286 0c73.520274 0 133.12-16.65024 133.12-71.179703S829.817417 772.388571 756.297143 772.388571 623.177143 828.073691 623.177143 882.603154C623.177143 937.132617 682.776869 953.782857 756.297143 953.782857z"
            fill="#F8E8D9"
            p-id="1609"
          ></path>
          <path
            d="M273.372891 867.936549a8.777143 8.777143 0 0 0-17.124205-3.853166c-2.363977 10.500389-4.251063 27.118446-2.23232 43.382491 1.980709 15.989029 8.04864 33.83296 23.727543 43.537555a8.777143 8.777143 0 1 0 9.242331-14.924069c-8.897097-5.506194-13.800594-16.676571-15.550171-30.772663-1.714469-13.824-0.087771-28.3648 1.936822-37.370148z m-98.075794 11.969097a8.777143 8.777143 0 1 0-16.9984-4.385646c-2.153326 8.349989-4.049189 21.714651-2.878903 35.380663 1.158583 13.499246 5.459383 28.885577 17.302675 39.245531a8.777143 8.777143 0 1 0 11.556571-13.2096c-6.878354-6.02112-10.377509-15.991954-11.369326-27.533897-0.974263-11.372251 0.643657-22.729874 2.387383-29.497051z m541.71648-9.043383a8.777143 8.777143 0 0 1 17.127132-3.853166c2.363977 10.500389 4.248137 27.118446 2.23232 43.382492-1.983634 15.989029-8.04864 33.83296-23.730469 43.537554a8.777143 8.777143 0 1 1-9.239406-14.924069c8.897097-5.506194 13.800594-16.676571 15.550172-30.772663 1.711543-13.824 0.087771-28.3648-1.939749-37.370148z m98.075794 11.969097a8.777143 8.777143 0 0 1 16.9984-4.385646c2.156251 8.349989 4.052114 21.714651 2.878903 35.380663-1.155657 13.499246-5.459383 28.885577-17.299748 39.245532a8.777143 8.777143 0 1 1-11.559497-13.2096c6.88128-6.02112 10.380434-15.991954 11.369325-27.533898 0.974263-11.372251-0.640731-22.729874-2.387383-29.497051z"
            fill="#614D4C"
            p-id="1610"
          ></path>
          <path
            d="M217.345463 596.2752c43.379566 6.828617 91.498789 15.342446 122.569874 21.100251a2.922789 2.922789 0 1 1-1.06496 5.751955c-31.038903-5.749029-79.102537-14.25408-122.414811-21.070995-21.659063-3.411383-42.10688-6.395611-58.631315-8.402651-16.653166-2.024594-29.005531-3.01056-34.684342-2.548297a2.925714 2.925714 0 1 1-0.476892-5.830949c6.386834-0.523703 19.368229 0.564663 35.866332 2.571703 16.623909 2.018743 37.147794 5.014674 58.836114 8.428983zM774.869577 581.643703c-44.549851 6.828617-93.968091 15.342446-125.881783 21.100251a2.925714 2.925714 0 0 0 1.041555 5.757806c31.875657-5.751954 81.241234-14.25408 125.72672-21.07392 22.244206-3.408457 43.244983-6.392686 60.219977-8.402651 17.1008-2.021669 29.801326-3.013486 35.65568-2.545372a2.925714 2.925714 0 0 0 0.462263-5.833874c-6.541897-0.520777-19.853897 0.564663-36.805486 2.568777-17.071543 2.021669-38.148389 5.0176-60.418926 8.428983zM244.917394 648.938057c-43.379566 6.828617-91.498789 15.342446-122.569874 21.100252a2.925714 2.925714 0 1 0 1.06496 5.751954c31.038903-5.749029 79.102537-14.25408 122.414811-21.070994 21.659063-3.411383 42.10688-6.395611 58.631315-8.402652 16.653166-2.024594 29.005531-3.01056 34.684343-2.548297a2.925714 2.925714 0 1 0 0.476891-5.830949c-6.386834-0.523703-19.368229 0.564663-35.866331 2.571703-16.623909 2.018743-37.147794 5.014674-58.836115 8.428983zM746.501851 637.232274c44.549851 6.828617 93.968091 15.342446 125.881783 21.100252a2.925714 2.925714 0 0 1-1.041554 5.757805c-31.875657-5.751954-81.241234-14.25408-125.72672-21.07392-22.244206-3.408457-43.244983-6.392686-60.219977-8.402651-17.1008-2.021669-29.801326-3.013486-35.65568-2.545371a2.925714 2.925714 0 0 1-0.462263-5.833875c6.541897-0.520777 19.853897 0.564663 36.805486 2.568777 17.071543 2.021669 38.148389 5.0176 60.418925 8.428983z"
            fill="#FFFFFF"
            p-id="1611"
          ></path>
          <path
            d="M648.045714 520.768366c-18.581211 0-33.645714-14.409143-33.645714-32.182857s15.064503-32.182857 33.645714-32.182858 33.645714 14.409143 33.645715 32.182858-15.064503 32.182857-33.645715 32.182857z m-280.868571 0.008777c18.581211 0 33.645714-14.409143 33.645714-32.182857s-15.064503-32.182857-33.645714-32.182857-33.645714 14.409143-33.645714 32.182857 15.064503 32.182857 33.645714 32.182857z"
            fill="#2A75AE"
            p-id="1612"
          ></path>
          <path
            d="M650.971429 471.031223a4.388571 4.388571 0 1 1 0-8.777143 4.388571 4.388571 0 0 1 0 8.777143z m-286.72 0.008777a4.388571 4.388571 0 1 0-0.002926-8.780069A4.388571 4.388571 0 0 0 364.251429 471.04z"
            fill="#FFFFFF"
            p-id="1613"
          ></path>
        </svg>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, watch } from "vue";
import { getBirthdayInfo, getSelectDateInfo } from "./utils";
import { appStore } from "@/store/app";
import { getTodayTodoList } from "@/api/home";
import { TodoModel } from "@/modules/common";

const app = appStore();

const selectDay = defineModel({ type: String });
const dateInfo = ref();
// ------------------------------ 获取选中日期相关信息 ------------------------------
const todoList = ref<TodoModel[]>([]);
const getTodoList = async (date: string) => {
  const { data } = await getTodayTodoList(date);
  todoList.value = data;
};

watch(
  () => selectDay.value,
  (val) => {
    if (val) {
      dateInfo.value = {
        ...getSelectDateInfo(val),
        birthday: getBirthdayInfo(val),
      };
      getTodoList(val);
    }
  },
  {
    immediate: true,
  }
);
</script>
<style lang="scss" scoped>
@import "@/styles/mixin";
.calendar-panel {
  padding: 25px 15px;
  width: 100%;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  align-items: center;
  color: var(--text);
  overflow: hidden scroll;
  .calendar-window {
    width: 100%;
    height: 200px;
    img {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      object-fit: cover;
      user-select: none;
    }
  }
  .current-date {
    font-size: 24px;
    height: 50px;
    line-height: 50px;
    margin-bottom: 15px;
  }
  .calendar-birthday {
    padding: 10px;
    margin-bottom: 15px;
    text-align: center;
    border-radius: 5px;
    background-color: var(--theme-color);
    color: #fff;
    user-select: none;
    .name {
      margin: 0 10px;
    }
  }
  .nothing {
    line-height: 40px;
    width: 100%;
    padding: 0 10px;
    text-align: center;
    box-sizing: border-box;
    & > div {
      color: #fff;
      background-color: var(--theme-color);
      border-radius: 8px;
    }
  }
  .task-list {
    width: 100%;
    font-size: 14px;
    .task-item {
      height: 40px;
      line-height: 40px;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: 0.3s background;
      border-radius: 5px;
      padding: 0 10px;
      &:hover {
        background-color: var(--input-bg);
        color: var(--text);
        .task-del {
          width: 20px;
        }
      }
      .task_content {
        flex: 1;
        @include ellipsis();
      }
    }
  }
}
</style>
